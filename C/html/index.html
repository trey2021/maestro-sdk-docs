<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Maestro C API: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Icon-green-64.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Maestro C API
   &#160;<span id="projectnumber">v0.1 Alpha</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Maestro C API Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="../images/social-cover.png"/>
</div>
<h2>Introduction</h2>
<p>The Maestro C API allows developers to build tools and applications that utilize the Maestro glove's motion capture and haptic functionality.</p>
<h2>Terminology</h2>
<div class="image">
<img src="../images/hand-joint-diagram.png"/>
</div>
<p>The documentation and SDK refer to different joints in the hand and finger using the terminology depicted above. The first joint on the thumb (where the thumb connects to the palm) has both a proximal rotation that controls inward rotation, much like the finger proximal joints, as well as an abduction rotation that controls the side-to-side rotation of the thumb. These two rotations paired together allow for the circular rotation of the thumb.</p>
<h2>Usage</h2>
<h3>Initial Setup</h3>
<p>There are configuration files that must be in place for the API to function properly. These are copied to the correct locations by the <a href="https://github.com/Contact-Control-Interfaces/maestro-installer">Maestro installer</a> (be sure to run the installer associated with the API version you're using).</p>
<p><a class="anchor" id="configHeader"></a></p>
<h3>Configuration</h3>
<p>The configuration files for the Maestro can be found in <code>%LOCALAPPDATA%\Contact Control Interfaces\Maestro\[VERSION]\Configuration</code> where <code>[VERSION]</code> is the version of the SDK that you're working with. For the 0.1 Alpha version, the configuration is located at <code>%LOCALAPPDATA%\Contact Control Interfaces\Maestro\v0.1a\Configuration</code>.</p>
<p>Inside of the configuration directory, you'll find two files: <code>left_maestro_rotation_ranges.txt</code> and <code>right_maestro_rotation_ranges.txt</code>. In most cases the contents of these two files should be the same, but you're able to configure the rotation ranges per-glove if desired. The contents of the rotation range files are used for calculating the rotation of individual joints.</p>
<p>Each line in the file represents a single joint with a comma delimited string of three values: the name of the joint, the minimum rotation, and the maximum rotation. The rotations themselves are specified as positive or negative floating-point numbers in the inclusive range <code>(0, 1)</code>, where <code>0</code> is no rotation, and <code>1</code> is a complete rotation (360 degrees). An example of the contents of one of these rotation range files can be seen below: </p><pre class="fragment">Wrist,-0.12,0.12
IndexProximal,-0.06,0.3
MiddleProximal,-0.06,0.3
RingProximal,-0.06,0.3
LittleProximal,-0.06,0.3
ThumbMetacarpal,-0.15,0.25
ThumbAbduction,-0.06,0.075
</pre><h3>Development</h3>
<p>To use the API, you must include the shared library and include the provided header files.</p>
<ol type="1">
<li>The Maestro detection thread must be running for plugged in gloves to be detected. This is as simple as calling <code><a class="el" href="group__glove_management.html#ga10088517f643220611dfcd5da08bfaa1">start_maestro_detection_service()</a></code>.</li>
<li>Now that the service is running, you can use <code><a class="el" href="group__glove_management.html#ga85666868951331c5266df7559abeefbc">is_glove_connected(intptr_t maestroPtr)</a></code> to determine if a glove is connected. Pass in the appropriate glove pointer obtained by <code><a class="el" href="group__glove_management.html#ga63ce3c99d4a8b8db851b22af9185764e">get_left_glove_pointer()</a></code> or <code><a class="el" href="group__glove_management.html#ga9b8fd9d91aeac3f8da50f7a7eba0c32b">get_right_glove_pointer()</a></code>.</li>
<li>Once a glove is connected, the glove must be calibrated before the motion capture data can be used. See <a href="#calibrationHeader">Calibration</a></li>
</ol>
<p>Once the Maestro is calibrated, you may retrieve motion capture data for your use in your application, as well as control the vibration and force-feedback haptic systems. For details, view the appropriate modules in the navigation on the left of the page.</p>
<p>Here's a single C program that continously outputs the wrist rotation:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;maestro.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> calibrate_wrist(intptr_t rightGlove)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Beginning wrist calibration. Hit enter when done...&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__glove_calibration.html#ga7a6d895e59fe7a4f554b05ab067087cc">start_wrist_calibration</a>(rightGlove)) {</div><div class="line">        getchar();</div><div class="line">        result = <a class="code" href="group__glove_calibration.html#ga4528575643eb59c92277338516679588">end_wrist_calibration</a>(rightGlove);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> result;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> calibrate_fingers(intptr_t rightGlove)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Beginning proximal calibration. Hit enter when done...&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__glove_calibration.html#ga8aa9f0c942b42299bc16440ce3d2c785">start_proximal_calibration</a>(rightGlove)) {</div><div class="line">        getchar();</div><div class="line">        result = <a class="code" href="group__glove_calibration.html#gaca292cd71d6b63a803381ba9a43c3d85">end_proximal_calibration</a>(rightGlove);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> result;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> calibrate_thumb(intptr_t rightGlove)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;Beginning thumb calibration. Hit enter when done...&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__glove_calibration.html#ga8d3e246642b4dbb70be016ad320cc320">start_thumb_calibration</a>(rightGlove)) {</div><div class="line">        getchar();</div><div class="line">        result = <a class="code" href="group__glove_calibration.html#gaab1a5c7b6a32fa01bfad60f964065355">end_thumb_calibration</a>(rightGlove);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> result;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> exit_status = EXIT_SUCCESS;</div><div class="line"></div><div class="line">    <span class="comment">//Start the Maestro detection thread. This thread will handle connecting/disconnecting Maestro gloves</span></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__glove_management.html#ga10088517f643220611dfcd5da08bfaa1">start_maestro_detection_service</a>()) {</div><div class="line">        intptr_t rightGlove = <a class="code" href="group__glove_management.html#ga9b8fd9d91aeac3f8da50f7a7eba0c32b">get_right_glove_pointer</a>();</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Waiting for right glove...\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">//Wait until right glove is connected</span></div><div class="line">        <span class="keywordflow">while</span> (!<a class="code" href="group__glove_management.html#ga85666868951331c5266df7559abeefbc">is_glove_connected</a>(rightGlove)) {</div><div class="line">            Sleep(250);</div><div class="line">        }</div><div class="line"></div><div class="line">        printf(<span class="stringliteral">&quot;Right glove found.\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">//Calibrate the Maestro</span></div><div class="line">        <span class="keywordflow">if</span> (calibrate_wrist(rightGlove)) {</div><div class="line">            <span class="keywordflow">if</span> (calibrate_fingers(rightGlove)) {</div><div class="line">                <span class="keywordflow">if</span> (calibrate_thumb(rightGlove)) {</div><div class="line"></div><div class="line">                    printf(<span class="stringliteral">&quot;Maestro calibration completed!\n&quot;</span>);</div><div class="line"></div><div class="line">                    <span class="comment">//Output wrist rotation</span></div><div class="line">                    <span class="keywordflow">while</span>(<span class="keyword">true</span>) {</div><div class="line">                        printf(<span class="stringliteral">&quot;Wrist rotation: %f\n&quot;</span>, <a class="code" href="group__rotation_access.html#ga155f18439d7b43c1722b035fc38a3225">get_wrist_proximal_rotation</a>(rightGlove));</div><div class="line">                        Sleep(100);</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Failed to start Maestro detection thread.\n&quot;</span>);</div><div class="line">        exit_status = EXIT_FAILURE;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> exit_status;</div><div class="line">}</div></div><!-- fragment --><p><a class="anchor" id="calibrationHeader"></a></p>
<h3>Calibration</h3>
<p>The calibration process consists of three steps: calibrating the wrist, and then the proximal joints of the fingers and thumb, and then the thumb. <b>The alpha release of the Maestro does not include independent distal joint tracking.</b></p>
<ol type="1">
<li>Calibrating the wrist: move your wrist through a full range of motion up and down. Try to keep your fingers flat (straight out) during this motion. <div class="image">
<img src="../video/wrist_calibration.gif"/>
</div>
</li>
<li>Calibrating the fingers: move your fingers through a full range of motion from flat to curled inward like a fist. <div class="image">
<img src="../video/fingers_calibration.gif"/>
</div>
</li>
<li>Calibrating the thumb: move your thumb through a full range of circular motion. <div class="image">
<img src="../video/thumb_calibration.gif"/>
</div>
</li>
</ol>
<p>You can repeat each of these motions during their respective calibration step until satisfied with the resulting calibration. You do not need to move at the same speed as the examples shown; as long as you don't move too quickly and/or inconsistently the quality of the calibration should not be noticeably impacted.</p>
<h2>Troubleshooting and debugging</h2>
<h3>Logging</h3>
<p>The Maestro API generates log files to help aid debugging in the event that glove is not properly connecting.</p>
<p>The log files for the Maestro can be found in <code>%LOCALAPPDATA%\Contact Control Interfaces\Maestro\[VERSION]\Logs</code>. Inside the <code>Logs</code> folder there will be log files of the format <code>maestro-[TIMESTAMP].log</code>, where <code>[TIMESTAMP]</code> is the local date on which that particular log file was generated.</p>
<p>The log messages themselves are formatted as follows: <code>[LONG TIMESTAMP][CATEGORY]: [MESSAGE]</code>. The category is included to aid readability, and usually the <code>ERROR</code> category will prove to be most useful in debugging. The category <code>ERROR</code> will also log the last error from Windows API. <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681381(v=vs.85).aspx">A complete list of all possible Windows system error codes can be found here.</a> Should the glove be successfully detected but fail to start, the log files will return one of the following error codes. Note that errors 5-10 deal with the motion ranges file specifically: </p><pre class="fragment">0 - Success (should never be logged, as this is not an error)
1 - Glove failed to start because it was already running.
2 - Failed to connect to the glove, usually because it was not plugged in.
3 - Failed to create a new thread for the connected glove.
4 - Deprecated
5 - Failed to find the appropriate motion range file, i.e. `left_maestro_rotation_ranges.txt` or `right_maestro_rotation_ranges.txt`.
6 - A required rotation range entry is missing. For example, the `IndexProximal` line is missing.
7 - A required rotation range entry is invalid. For example, having an extra comma or value.
8 - A rotation range entry is invalid, for instance having non-numeric characters in the rotation values.
9 - A rotation range is valid, but the values are in the incorrect order, that is to say not ascending.
10 - An entry's name is invalid, for instance having `IndexPrimoxal` instead of `IndexProximal`. Usually indicates a typo or extra line.
</pre><p>These files are generated purely to help debug easy to fix issues with the system or configuration, and can be deleted without issue if need be. Please note that these logs may not encompass any error that can occur, but should help diagnose most errors. Also please note that these logs report only on the Maestro device itself, and will give no insight into your calibration, or any project-related configuration that may be affecting your development.</p>
<p><b>Please contact us at <a href="#" onclick="location.href='mai'+'lto:'+'sup'+'po'+'rt@'+'co'+'nta'+'ct'+'ci.'+'co'; return false;">suppo<span style="display: none;">.nosp@m.</span>rt@c<span style="display: none;">.nosp@m.</span>ontac<span style="display: none;">.nosp@m.</span>tci.<span style="display: none;">.nosp@m.</span>co</a> with any questions.</b> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
